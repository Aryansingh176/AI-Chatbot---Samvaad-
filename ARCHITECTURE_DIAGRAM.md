# Component Architecture: Agent Handoff System

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SAMVAAD AI APP                                â”‚
â”‚                          (App.tsx)                                      â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Navbar     â”‚  â”‚   Sections   â”‚  â”‚    Footer    â”‚                 â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚                 â”‚
â”‚  â”‚ - Home       â”‚  â”‚ - Hero       â”‚  â”‚ - Team Info  â”‚                 â”‚
â”‚  â”‚ - About      â”‚  â”‚ - Features   â”‚  â”‚ - Copyright  â”‚                 â”‚
â”‚  â”‚ - Demo       â”‚  â”‚ - Tech       â”‚  â”‚              â”‚                 â”‚
â”‚  â”‚ - Contact    â”‚  â”‚ - Knowledge  â”‚  â”‚              â”‚                 â”‚
â”‚  â”‚              â”‚  â”‚ - Contact    â”‚  â”‚              â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ACTION BUTTONS (Navbar)                      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  Open Chat   â”‚ â”‚   History    â”‚ â”‚    Admin     â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   (Blue)     â”‚ â”‚   (Border)   â”‚ â”‚  (Purple)    â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                â”‚                â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“                â†“                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ChatBot      â”‚ â”‚ ChatHistory  â”‚ â”‚ AdminPanel   â”‚
    â”‚  Component     â”‚ â”‚  Component   â”‚ â”‚  Component   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ChatBot Component Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ChatBot.tsx                              â”‚
â”‚                                                                â”‚
â”‚  States:                                                       â”‚
â”‚  â”œâ”€ messages[]              (chat history)                     â”‚
â”‚  â”œâ”€ failedResponseCount     (tracks AI failures)              â”‚
â”‚  â”œâ”€ agentSessionId          (current session ID)              â”‚
â”‚  â”œâ”€ isAgentMode             (false â†’ true on handoff)         â”‚
â”‚  â””â”€ pollingRef              (real-time updates)               â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              NORMAL CHATBOT MODE                         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  User sends message                                      â”‚ â”‚
â”‚  â”‚       â†“                                                  â”‚ â”‚
â”‚  â”‚  Call AI API                                             â”‚ â”‚
â”‚  â”‚       â†“                                                  â”‚ â”‚
â”‚  â”‚  Success? â†’ Reset counter â†’ Display response            â”‚ â”‚
â”‚  â”‚  Fail?    â†’ Increment counter                            â”‚ â”‚
â”‚  â”‚       â†“                                                  â”‚ â”‚
â”‚  â”‚  Counter >= 2?                                           â”‚ â”‚
â”‚  â”‚       â†“                                                  â”‚ â”‚
â”‚  â”‚  Show "Talk to Human Agent" Button ğŸŸ¢                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â†“ (User clicks)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              AGENT HANDOFF                               â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  handleAgentHandoff()                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Get user data from localStorage                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Get last message                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ createAgentSession() â†’ utils/agentHandoff.ts        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Set isAgentMode = true                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ Start polling for agent responses                    â”‚ â”‚
â”‚  â”‚  â””â”€ Display "Connecting to agent..." message             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              AGENT MODE                                  â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  User types message                                      â”‚ â”‚
â”‚  â”‚       â†“                                                  â”‚ â”‚
â”‚  â”‚  sendAgentMessage()                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ addMessageToSession() â†’ utils/agentHandoff.ts       â”‚ â”‚
â”‚  â”‚  â””â”€ Display in chat                                      â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  Polling active (every 2 seconds)                        â”‚ â”‚
â”‚  â”‚       â†“                                                  â”‚ â”‚
â”‚  â”‚  Check for new messages from agent                       â”‚ â”‚
â”‚  â”‚       â†“                                                  â”‚ â”‚
â”‚  â”‚  Display agent messages with ğŸ§‘ icon                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## AdminPanel Component Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AdminPanel.tsx                              â”‚
â”‚                                                                â”‚
â”‚  States:                                                       â”‚
â”‚  â”œâ”€ sessions[]              (all sessions)                     â”‚
â”‚  â”œâ”€ selectedSession         (current chat)                     â”‚
â”‚  â”œâ”€ filterStatus            (waiting/active/resolved/all)      â”‚
â”‚  â”œâ”€ messageInput            (admin's message)                  â”‚
â”‚  â”œâ”€ stats                   (counts by status)                 â”‚
â”‚  â””â”€ pollingRef              (real-time updates)                â”‚
â”‚                                                                â”‚
â”‚  Layout: 3 Sections                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HEADER (Purple Gradient)                              â”‚   â”‚
â”‚  â”‚  - Title: "Admin Panel"                                â”‚   â”‚
â”‚  â”‚  - Subtitle: "Manage user support requests"            â”‚   â”‚
â”‚  â”‚  - Close button                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STATISTICS BAR                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚Total â”‚ â”‚Yellowâ”‚ â”‚ Blue â”‚ â”‚Green â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚  10  â”‚ â”‚  3   â”‚ â”‚  5   â”‚ â”‚  2   â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SESSION LIST    â”‚      CHAT AREA                      â”‚   â”‚
â”‚  â”‚  (Left 1/3)      â”‚      (Right 2/3)                    â”‚   â”‚
â”‚  â”‚                  â”‚                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Search    â”‚  â”‚  â”‚  Session Header             â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  - User name/email          â”‚   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  - Status badge             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Filters   â”‚  â”‚  â”‚  - Action buttons           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ All|W|A|R  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                     â”‚   â”‚
â”‚  â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  Session Cards:  â”‚  â”‚  Messages                   â”‚   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ğŸŸ¡ John Doe â”‚â†â”€â”¼â”€â”€â”‚  User: Help!                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Waiting    â”‚  â”‚  â”‚  Bot: ...                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ "I need..."â”‚  â”‚  â”‚  Agent: I'm here!           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                             â”‚   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â”‚ğŸ”µ Jane Doe â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚  â”‚ Active     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ "Payment..."â”‚  â”‚  â”‚  Input Area                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚   Text    â”‚ â”‚Send â”‚      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ğŸŸ¢ Bob Smithâ”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Resolved   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  Auto-refresh: Every 3 seconds                                 â”‚
â”‚  Polling: Active when session selected (2 second interval)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: agentHandoff.ts Utility

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  utils/agentHandoff.ts                         â”‚
â”‚                                                                â”‚
â”‚  Storage: localStorage['agentSessions']                        â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CORE FUNCTIONS                                          â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  generateSessionId()                                     â”‚ â”‚
â”‚  â”‚  â””â”€â†’ "SESSION-1732300800000-abc123"                     â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  createAgentSession(email, name, message, failures)     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Generate unique ID                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Create session object                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Add initial message                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ Set status = 'waiting'                               â”‚ â”‚
â”‚  â”‚  â””â”€ Save to localStorage                                 â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  addMessageToSession(sessionId, text, sender)           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Load sessions                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Find session                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Add message with timestamp                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update session.updatedAt                             â”‚ â”‚
â”‚  â”‚  â””â”€ Save to localStorage                                 â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  updateSessionStatus(sessionId, status, agent?)         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Find session                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update status                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Set assignedAgent if provided                        â”‚ â”‚
â”‚  â”‚  â””â”€ Save to localStorage                                 â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  getSession(sessionId)                                   â”‚ â”‚
â”‚  â”‚  getSessionsByStatus(status)                             â”‚ â”‚
â”‚  â”‚  getAllSessions()                                        â”‚ â”‚
â”‚  â”‚  getSessionStats()                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  POLLING CLASS                                           â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  class SessionPolling {                                  â”‚ â”‚
â”‚  â”‚    start(sessionId, callback)                            â”‚ â”‚
â”‚  â”‚    â”œâ”€ Set interval (2 seconds)                           â”‚ â”‚
â”‚  â”‚    â”œâ”€ Check for new messages                             â”‚ â”‚
â”‚  â”‚    â”œâ”€ Compare timestamps                                 â”‚ â”‚
â”‚  â”‚    â””â”€ Call callback with new messages                    â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚    stop()                                                â”‚ â”‚
â”‚  â”‚    â””â”€ Clear interval                                     â”‚ â”‚
â”‚  â”‚  }                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  Types:                                                        â”‚
â”‚  â”œâ”€ MessageSender = 'user' | 'bot' | 'agent'                  â”‚
â”‚  â”œâ”€ AgentMessage { id, sessionId, text, sender, timestamp }   â”‚
â”‚  â””â”€ AgentSession { id, userEmail, userName, status,           â”‚
â”‚                    messages[], createdAt, updatedAt... }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Real-time Communication Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REAL-TIME SYNC FLOW                          â”‚
â”‚                                                                 â”‚
â”‚  Time: T0                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   ChatBot    â”‚                    â”‚ AdminPanel   â”‚          â”‚
â”‚  â”‚              â”‚                    â”‚              â”‚          â”‚
â”‚  â”‚ lastTimestampâ”‚                    â”‚lastTimestamp â”‚          â”‚
â”‚  â”‚ = 1000       â”‚                    â”‚= 1000        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â†“                                    â†“                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                      â†“                                          â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚            â”‚  localStorage    â”‚                                 â”‚
â”‚            â”‚  agentSessions   â”‚                                 â”‚
â”‚            â”‚  [{session1...}] â”‚                                 â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                 â”‚
â”‚  Time: T1 (User sends message)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   ChatBot    â”‚                    â”‚ AdminPanel   â”‚          â”‚
â”‚  â”‚              â”‚                    â”‚              â”‚          â”‚
â”‚  â”‚ Write to â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚
â”‚  â”‚ localStorage â”‚                    â”‚              â”‚          â”‚
â”‚  â”‚ timestamp=   â”‚                    â”‚ Polling...   â”‚          â”‚
â”‚  â”‚ 1500         â”‚                    â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                              â†“                  â”‚
â”‚                                      (Check for new messages)   â”‚
â”‚                                      (Find message @ 1500)      â”‚
â”‚                                      (Display in UI)            â”‚
â”‚                                                                 â”‚
â”‚  Time: T2 (Admin responds)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   ChatBot    â”‚                    â”‚ AdminPanel   â”‚          â”‚
â”‚  â”‚              â”‚                    â”‚              â”‚          â”‚
â”‚  â”‚ Polling...  <â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€ Write to  â”‚          â”‚
â”‚  â”‚              â”‚                    â”‚  localStorageâ”‚          â”‚
â”‚  â”‚              â”‚                    â”‚  timestamp=  â”‚          â”‚
â”‚  â”‚              â”‚                    â”‚  2000        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â†“                                                       â”‚
â”‚  (Check for new messages)                                       â”‚
â”‚  (Find message @ 2000)                                          â”‚
â”‚  (Display in UI)                                                â”‚
â”‚                                                                 â”‚
â”‚  Result: < 3 second delay for message delivery                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure

```
project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ChatBot.tsx          [âœ“ Modified - Added handoff]
â”‚   â”‚   â”œâ”€â”€ AdminPanel.tsx       [âœ“ New - Full dashboard]
â”‚   â”‚   â”œâ”€â”€ UserMenu.tsx         [Existing - No changes]
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ agentHandoff.ts      [âœ“ New - Core logic]
â”‚   â”‚   â””â”€â”€ chatHistory.ts       [Existing - No changes]
â”‚   â””â”€â”€ App.tsx                  [âœ“ Modified - Added admin button]
â”œâ”€â”€ AGENT_HANDOFF_GUIDE.md       [âœ“ New - Full documentation]
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md    [âœ“ New - Implementation details]
â”œâ”€â”€ QUICK_START_AGENT_HANDOFF.md [âœ“ New - Quick start guide]
â””â”€â”€ ARCHITECTURE_DIAGRAM.md      [âœ“ New - This file]
```

## Key Integration Points

1. **App.tsx â†’ ChatBot**
   - Opens via `setShowChatBot(true)`
   - Passes user data
   - Handles close events

2. **App.tsx â†’ AdminPanel**
   - Opens via `setShowAdminPanel(true)`
   - Only visible when user logged in
   - Independent of ChatBot state

3. **ChatBot â†’ agentHandoff.ts**
   - Creates sessions
   - Adds user messages
   - Polls for agent responses

4. **AdminPanel â†’ agentHandoff.ts**
   - Reads all sessions
   - Adds agent messages
   - Updates session status
   - Polls for user responses

5. **Both â†’ localStorage**
   - Single source of truth
   - Automatic sync
   - No conflicts (append-only messages)

## Performance Characteristics

- **Memory**: ~1KB per session (text only)
- **Network**: None (localStorage only)
- **CPU**: Minimal (polling checks timestamps)
- **Storage**: Grows with session count
- **Cleanup**: Manual (admin can delete resolved)

## Security Considerations

âš ï¸ **Current Implementation (Development)**
- Data stored in browser localStorage
- No encryption
- Accessible to anyone with browser access
- Single-device only

âœ… **Production Recommendations**
- Move to backend API
- Encrypt sensitive data
- Add authentication/authorization
- Implement session expiry
- Add audit logging
- Rate limiting for message creation
